(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{582:function(e,t,s){"use strict";s.r(t);var n=s(43),r=Object(n.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h2",{attrs:{id:"wsl2をdockerのホストにする"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#wsl2をdockerのホストにする"}},[e._v("#")]),e._v(" WSL2をDockerのホストにする")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://qiita.com/tomokei5634/items/27504849bb4353d8fef8",target:"_blank",rel:"noopener noreferrer"}},[e._v("先人の知恵を拝借"),s("OutboundLink")],1)]),e._v(" "),s("p",[e._v("コマンドプロンプトがubuntuになった感じ。\nwindowsはハードウェア自由だし、\nsshもwslから実行すればいいから、\n個人的には開発環境としてmac超えた。")]),e._v(" "),s("h2",{attrs:{id:"wsl2をwindows-terminalで操作する"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#wsl2をwindows-terminalで操作する"}},[e._v("#")]),e._v(" WSL2をWindows Terminalで操作する")]),e._v(" "),s("p",[e._v("ドックからubuntuを起動するとDOSプロンプトになるから、windows terminalのデフォルトシェルをwslにしておく。\nterminalのタブにあるキャレットの「設定」クリックで、"),s("code",[e._v("settings.json")]),e._v("が開く。\nalt押しながら「設定」クリックで開く"),s("code",[e._v("defaults.json")]),e._v("をsettings.jsonでオーバーライドするイメージ。")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("    // To learn more about color schemes, visit https://aka.ms/terminal-color-schemes\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("のコメントにあったリンクでデフォルトカラースキーマの一覧が確認できる。\n"),s("code",[e._v("settings.json")]),e._v("の"),s("code",[e._v("profiles")]),e._v("にリストされているシェルの設定に")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('                "name": "Ubuntu",\n                "source": "Windows.Terminal.Wsl",\n                "commandline": "wsl.exe ~ -d Ubuntu",\n                "colorScheme": "Tango Dark",\n//                "useAcrylic": true,\n//                "acrylicOpacity": 0.8\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br")])]),s("p",[e._v("みたいな追記だけした。チルダは$HOME開くコマンド。\n細かいカスタマイズは気力ない。\nでも、"),s("a",{attrs:{href:"http://nanno.dip.jp/softlib/man/rlogin/",target:"_blank",rel:"noopener noreferrer"}},[e._v("rlogin"),s("OutboundLink")],1),e._v("ほど細かいチューニングはいらなくて楽。")]),e._v(" "),s("h2",{attrs:{id:"wsl2のデーモン"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#wsl2のデーモン"}},[e._v("#")]),e._v(" WSL2のデーモン")]),e._v(" "),s("p",[e._v("snap使おうとしてsystemctlが動いてないことが発覚。")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("% systemctl\nSystem has not been booted with systemd as init system (PID 1). Can't operate.\nFailed to connect to bus: Host is down\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("p",[e._v("不具合かと思ったけど、現状のwsl2だとこれで正常っぽい。\n"),s("a",{attrs:{href:"https://github.com/DamionGans/ubuntu-wsl2-systemd-script.git",target:"_blank",rel:"noopener noreferrer"}},[e._v("独自に解決"),s("OutboundLink")],1),e._v("してる人はいた。\n起動スクリプト変更してPID1のプロセスを差し替えるような変更で、\n試して実際に動かすことはできた。\n"),s("a",{attrs:{href:"https://hnakamur.github.io/blog/2020/05/30/run-systemd-snapd-and-lxd-on-wsl2-ubuntu/",target:"_blank",rel:"noopener noreferrer"}},[e._v("この人の話"),s("OutboundLink")],1),e._v("だと\nDocker Desktopもいらなくなるようだけど、snapもsystemctlもマストじゃないしトラブルの元になりそうだから、\n元に戻して使わない方向にした。そのうち本体で解消しそうな？")]),e._v(" "),s("h2",{attrs:{id:"wsl2でnode"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#wsl2でnode"}},[e._v("#")]),e._v(" WSL2でnode")]),e._v(" "),s("p",[e._v("yarnで"),s("code",[e._v("permission denied")]),e._v("になって気がついたけど、\naptでインストールされたnodejsを使っていた。\n"),s("code",[e._v("sudo")]),e._v("でもいいけどちょっと調べたら、\n"),s("a",{attrs:{href:"https://docs.microsoft.com/ja-jp/windows/nodejs/setup-on-wsl2",target:"_blank",rel:"noopener noreferrer"}},[e._v("micrsoftの方でnvm使おうって解説してたりする"),s("OutboundLink")],1),e._v("ので入れ替えた。")]),e._v(" "),s("p",[e._v("nvm.shでlocaleを実行していているのかlocaleがエラーになったので気づいたが、\nlanguage-packがインストールされていなかった。")]),e._v(" "),s("h2",{attrs:{id:"wsl2のシェルセットアップ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#wsl2のシェルセットアップ"}},[e._v("#")]),e._v(" WSL2のシェルセットアップ")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("sudo apt install build-essential zsh golang python3-pip liblua5.3-dev ncurses-dev direnv\npip3 install msgpack\nconfigurevim\nmake\n./src/vim --version\nsudo make install\nsudo update-alternatives --install /usr/bin/editor editor /usr/local/bin/vim 100\nsudo update-alternatives --config editor\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br")])]),s("p",[e._v("vim系で時間を空費したのでメモっとく。")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://secret-garden.hatenablog.com/entry/2016/07/11/222728",target:"_blank",rel:"noopener noreferrer"}},[e._v("1つめ"),s("OutboundLink")],1),s("code",[e._v("dein")]),e._v("は"),s("code",[e._v("job_start")]),e._v("使ってるので"),s("code",[e._v("--disable-channel")]),e._v("はできない")]),e._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/Shougo/deoplete.nvim",target:"_blank",rel:"noopener noreferrer"}},[e._v("2つめ"),s("OutboundLink")],1),s("code",[e._v("neocomplete")]),e._v("の開発は終わってるようで、"),s("code",[e._v("vim8.2")]),e._v("だと"),s("code",[e._v("deoplete")]),e._v("に移行しないとならなかった")])]),e._v(" "),s("p",[e._v("そういえばoh-my-zshってあったなと思って調べたら、\n何年も前に既に古いって判断がされてて、preztoがオススメになってたけど、形勢逆転してるっぽい？\nbash天下でzsh使う理由は趣味なのでこだわる気もなく、oh-my-zshを使うことにした。")]),e._v(" "),s("p",[e._v("プラグインは慣れたエイリアスがあるので使わないけど、\n自分のシェル環境を検討する上で勉強になる要素がたくさんある。\nhttps://github.com/ohmyzsh/ohmyzsh/tree/master/plugins")]),e._v(" "),s("p",[e._v("テーマ選んでたらPowerlineフォントのインストールで脱線。")]),e._v(" "),s("h2",{attrs:{id:"powerlineフォント対応"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#powerlineフォント対応"}},[e._v("#")]),e._v(" Powerlineフォント対応")]),e._v(" "),s("p",[e._v("リガチャとか合字って開発で意識したことなかったけど"),s("a",{attrs:{href:"https://docs.microsoft.com/ja-jp/windows/terminal/cascadia-code",target:"_blank",rel:"noopener noreferrer"}},[e._v("解説"),s("OutboundLink")],1),e._v("まであった。")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://docs.microsoft.com/ja-jp/windows/terminal/tutorials/powerline-setup",target:"_blank",rel:"noopener noreferrer"}},[e._v("chocoで管理する"),s("OutboundLink")],1)]),e._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/yuru7/HackGen",target:"_blank",rel:"noopener noreferrer"}},[e._v("白源"),s("OutboundLink")],1),e._v("ってフォントも見つけて\nPowerline対応してるらしいけど、Windows Terminalだと表示されなかった。")]),e._v(" "),s("p",[e._v("とりあえずWindows TerminalとVSCodeのターミナルは「Cascadia Code PL」にしといた。")]),e._v(" "),s("p",[e._v("で、oh-my-zshの有名なPowerlineテーマ"),s("a",{attrs:{href:"https://github.com/caiogondim/bullet-train.zsh",target:"_blank",rel:"noopener noreferrer"}},[e._v("Bullet Train"),s("OutboundLink")],1),e._v("を入れた。\n"),s("a",{attrs:{href:"https://github.com/ohmyzsh/ohmyzsh/wiki/External-themes",target:"_blank",rel:"noopener noreferrer"}},[e._v("非公式テーマ"),s("OutboundLink")],1),e._v("は、"),s("code",[e._v("$ZSH_CUSTOM/themes")]),e._v("に置く。シンボリックでOK。")]),e._v(" "),s("p",[e._v("vimで有名なPowerlineテーマ"),s("a",{attrs:{href:"https://github.com/vim-airline/vim-airlinea",target:"_blank",rel:"noopener noreferrer"}},[e._v("vim-airline"),s("OutboundLink")],1),e._v("も入れた。")]),e._v(" "),s("h2",{attrs:{id:"wsl2からwindowsのファイル操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#wsl2からwindowsのファイル操作"}},[e._v("#")]),e._v(" WSL2からWindowsのファイル操作")]),e._v(" "),s("p",[e._v("/mnt/cがやたら遅い。\n後から知ったけど"),s("a",{attrs:{href:"https://docs.microsoft.com/ja-jp/windows/wsl/compare-versions",target:"_blank",rel:"noopener noreferrer"}},[e._v("仕様"),s("OutboundLink")],1),e._v("だそうで、\nwindows上からgitはアンインストールした。")]),e._v(" "),s("h2",{attrs:{id:"wsl2からポートフォワード"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#wsl2からポートフォワード"}},[e._v("#")]),e._v(" WSL2からポートフォワード")]),e._v(" "),s("p",[s("code",[e._v(".wslconfig")]),e._v("を設置するだけ。")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://docs.microsoft.com/ja-jp/windows/wsl/wsl-config#configure-global-options-with-wslconfig",target:"_blank",rel:"noopener noreferrer"}},[e._v("Wslconfig を使用してグローバルオプションを構成する"),s("OutboundLink")],1)]),e._v(" "),s("p",[e._v("vmはポートフォワードをvm毎に書いてるけど、\nそういう手間なく"),s("code",[e._v("localhost:8080")]),e._v("などでwindowsからwsl2にアクセスできるようになる。\nでも、"),s("a",{attrs:{href:"https://github.com/microsoft/WSL/issues/4636",target:"_blank",rel:"noopener noreferrer"}},[e._v("まだ不安定みたい"),s("OutboundLink")],1),e._v("で、\n自分の環境でも症状っぽいのは確認。")]),e._v(" "),s("p",[e._v("電源管理から「高速スタートアップ」を無効にしたら、一応、再現してないので様子見。")]),e._v(" "),s("h2",{attrs:{id:"wsl2からaws-cli"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#wsl2からaws-cli"}},[e._v("#")]),e._v(" WSL2からaws-cli")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://docs.aws.amazon.com/ja_jp/cli/latest/userguide/install-cliv2-docker.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("公式のDockerイメージ"),s("OutboundLink")],1),e._v("がある。\n"),s("code",[e._v("docker pull")]),e._v("してれば最新化できるから作業用のエイリアスを作ろう。")]),e._v(" "),s("h2",{attrs:{id:"wsl2-ホスト-からコンテナアクセス"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#wsl2-ホスト-からコンテナアクセス"}},[e._v("#")]),e._v(" WSL2(ホスト)からコンテナアクセス")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/docker-library/mysql/blob/master/5.7/Dockerfile",target:"_blank",rel:"noopener noreferrer"}},[e._v("mysql"),s("OutboundLink")],1),e._v("を例にすると、\nWSL2(ホスト)からmysql(コンテナ)へ"),s("code",[e._v("localhost")]),e._v("ではアクセスできないが"),s("code",[e._v("::1")]),e._v("なら接続できた。\n"),s("code",[e._v("docker run -i (--interactive)")]),e._v("しないとエラーメッセージが出力されなくて少しハマった。")])])}),[],!1,null,null,null);t.default=r.exports}}]);